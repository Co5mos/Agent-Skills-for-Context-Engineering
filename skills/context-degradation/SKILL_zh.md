---
name: context-degradation
description: 当用户要求“诊断上下文问题”、“修复迷失在中间（lost-in-middle）问题”、“调试助手失败”、“了解上下文毒化”，或提到上下文退化、注意力模式、上下文冲突、上下文混淆或助手性能下降时，应使用此技能。提供识别和缓解上下文失效的模式。
---

# 上下文退化模式 (Context Degradation Patterns)

随着上下文长度的增加，语言模型会表现出可预测的退化模式。理解这些模式对于诊断失效和设计具有韧性的系统至关重要。上下文退化不是一个二元状态，而是一个性能持续下降的过程，表现为几种不同的方式。

## 何时激活

在以下情况下启用此技能：
- 助手的性能在长对话中意外下降
- 调试助手产出错误或不相关输出的情况
- 设计必须可靠处理大上下文的系统
- 调查助手输出中的“迷失在中间”现象
- 分析助手行为中与上下文相关的失效

## 核心概念

上下文退化通过几种不同的模式表现出来。**“迷失在中间”**现象导致上下文中心的信息获得较少的注意力。**“上下文毒化”**发生在错误通过重复引用不断加剧时。**“上下文干扰”**发生在不相关信息淹没相关内容时。**“上下文混淆”**源于模型无法判断哪段上下文适用。**“上下文冲突”**则是累积的信息直接发生矛盾。

这些模式是可预测的，可以通过压缩、遮蔽、分区和隔离等架构模式来缓解。

## 详细主题

### 迷失在中间 (The Lost-in-Middle) 现象

最广为人知的退化模式是“迷失在中间”效应，即模型表现出 U 型注意力曲线。上下文开头和结尾的信息能获得可靠的注意力，而埋在中间的信息在检索准确率上会大幅下降。

研究表明，放置在上下文中间的相关信息，其检索准确率比放置在开头或结尾时低 10-40%。这并非模型本身的缺陷，而是注意力机制和训练数据分布的结果。

### 上下文毒化 (Context Poisoning)

当幻觉、错误或不正确的信息进入上下文，并通过重复引用不断加剧时，就会发生上下文毒化。一旦被毒化，上下文就会创建强化错误信念的反馈循环。

毒化通常通过三个途径进入：工具输出中的错误、检索文档中的陈旧信息、模型生成的摘要中的幻觉。如果助手的“目标”部分被毒化，它就会制定出需要极大努力才能纠正的错误策略。

### 上下文干扰 (Context Distraction)

当上下文变得太长，以至于模型过度关注提供的信息而牺牲了其训练知识时，就会出现上下文干扰。研究显示，即使上下文只有一个不相关的文档也会降低性能。多个干扰项会加剧退化。

### 上下文混淆 (Context Confusion)

当不相关的信息以降低质量的方式影响回复时，就会产生上下文混淆。如果将某些内容放入上下文，模型就必须关注它。助手可能会应用来自不同背景的约束，这在单一 session 中切换多个任务时尤为严重。

### 上下文冲突 (Context Clash)

当累积的信息直接冲突，产生相互矛盾的指导从而干扰推理时，就会产生上下文冲突。冲突通常源于多源检索、版本冲突或观点冲突。

### 经验基准与阈值 (RULER 基准测试)

RULER 基准测试给出了发人深省的发现：只有 50% 声称支持 32K+ 上下文的模型在 32K token 时能维持令人满意的性能。在简单的“大海捞针”测试中获得近乎满意的分数，并不能等同于真实的长上下文理解。

**模型特定退化阈值参考：**
| 模型 | 退化起始 | 严重退化 |
| :--- | :--- | :--- |
| GPT-5.2 | ~64K tokens | ~200K tokens |
| Claude Opus 4.5 | ~100K tokens | ~180K tokens |
| Claude Sonnet 4.5 | ~80K tokens | ~150K tokens |
| Gemini 3 Pro | ~500K tokens | ~800K tokens |

### 反直觉的发现
- **乱序的“干草堆”优于连贯的**：逻辑连贯的上下文可能会产生误导性的关联，干扰检索。
- **单个干扰项的影响巨大**：干扰项的影响不是线性的，而是阶梯式的。

## 实践指南

### 四桶法 (The Four-Bucket Approach)
1. **写入 (Write)**：将上下文保存在窗口之外（文件系统、外部存储）。
2. **选择 (Select)**：通过检索和过滤，将真正相关的上下文拉入窗口。
3. **压缩 (Compress)**：通过摘要、抽象和观察遮蔽来减少 token。
4. **隔离 (Isolate)**：跨子助手或 session 拆分上下文，防止单个上下文过大。

## 准则

1. 在开发过程中监控上下文长度与性能的相关性。
2. 将关键信息放置在上下文的开头或结尾。
3. 在退化变得严重之前实施压缩触发器。
4. 在将检索到的文档加入上下文之前验证其准确性。
5. 使用版本控制防止旧信息引起冲突。
6. 分隔任务以防止不同目标之间的上下文混淆。

## 技巧元数据

**创建日期**: 2025-12-20
**作者**: Agent Skills for Context Engineering 贡献者
**版本**: 1.0.0
