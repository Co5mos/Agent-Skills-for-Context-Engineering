---
name: memory-systems
description: 当用户要求“实现助手记忆”、“跨会话持久化状态”、“构建知识图谱”、“追踪实体”，或提到记忆架构、时序知识图谱、向量数据库、实体记忆或跨会话持久化时，应使用此技巧。
---

# 记忆系统设计 (Memory System Design)

记忆为助手提供了持久化层，使其能够在跨会话中保持连续性，并对积累的知识进行推理。简单的助手完全依赖上下文作为记忆，当会话结束时，所有状态都会丢失。复杂的助手实现了多层记忆架构，平衡了即时上下文需求与长期知识保留。从向量数据库到知识图谱，再到时序知识图谱（Temporal Knowledge Graphs），代表了为提高检索和推理能力而在结构化记忆上的投入不断增加。

## 何时激活

在以下情况下启用此技能：
- 构建必须跨会话持久化的助手
- 需要在对话中保持实体一致性
- 实现对积累知识的推理
- 设计能从过去交互中学习的系统
- 构建随时间增长的知识库
- 构建追踪状态变化的时序感知系统

## 核心概念

记忆存在于从**即时上下文**到**永久存储**的光谱上。光谱的一端是上下文窗口中的工作记忆（零延迟，但随会话结束而消失）；另一端是永久存储（无限期持久化，但需要检索才能进入上下文）。

简单的向量数据库缺乏关系和时间结构。**知识图谱**保留了用于推理的关系。**时序知识图谱**则为事实增加了有效期，支持时间感知的查询。

## 详细主题

### 记忆架构光谱
- **工作记忆 (Working Memory)**：即上下文窗口，零延迟，易失。用于跟踪中间结果（scratchpad）。
- **短期记忆 (Short-term Memory)**：会话内持久，可搜索。用于在不撑爆上下文的情况下维护会话状态。
- **长期记忆 (Long-term Memory)**：跨会话持久，结构化，半永久。
- **永久记忆 (Permanent Memory)**：归档式，永久化。

### 为什么简单的向量数据库（Vector RAG）不够
向量 RAG 提供语义检索，在处理文档检索时表现良好，但对助手记忆来说缺乏结构：
1.  **丢失关系信息**：无法回答“买过产品 Y 的客户还买了什么？”这类需要遍历关系的问题。
2.  **缺乏时序有效性**：事实会随时间变化，向量数据库无法区分“当前事实”与“陈旧事实”。

### 图谱化记忆的演进
- **知识图谱 (KG)**：保留实体间的关系（实体 A 与实体 B 有关系 R）。
- **时序知识图谱 (TKG)**：为事实增加“生效时间”和“失效时间”戳。支持“时间旅行”查询（查询特定时间点时的知识状态）。

### 记忆系统性能参考 (Deep Memory Retrieval 榜单)
- **Zep (时序 KG)**：准确率 94.8%，检索延迟 2.58s（相对于 GPT-5.2 全上下文基准的 28.9s 降低了 90%）。
- **GraphRAG**：较基准 RAG 提升 20-35% 的准确率，减少多达 30% 的幻觉。

## 记忆实现模式

### 模式 1：文件系统即记忆
利用文件系统层级结构进行组织。使用 JSON/YAML 存储事实，利用文件名中的时间戳进行时序追踪。
- **优点**：简单、透明、便携。
- **缺点**：无语义搜索，无关系追踪。

### 模式 2：带元数据的向量 RAG
为嵌入的文档附加实体标签、有效期、来源归属和置信度得分。

### 模式 3：知识图谱
显式建模实体和关系，使用图数据库（如 Neo4j）存储。

### 模式 4：时序知识图谱
增加有效期字段，支持恢复特定时间点的知识状态，防止由于陈旧信息导致的上下文冲突。

## 实践指南

### 记忆整合 (Consolidation)
记忆会随时间累积，需要通过整合来防止无限增长：
- 合并相关事实，更新有效期。
- 归档或删除过时事实，重建索引。

## Guidelines

1. 根据查询需求匹配记忆架构。
2. 为记忆访问实施渐进式披露。
3. 使用时序有效性防止陈旧信息冲突。
4. 定期整合记忆以防止数据过载。
5. 优雅地处理记忆检索失败的情况。
6. 考虑持久化记忆的隐私影响。

## 技巧元数据

**创建日期**: 2025-12-20
**作者**: Agent Skills for Context Engineering 贡献者
**版本**: 1.0.0
