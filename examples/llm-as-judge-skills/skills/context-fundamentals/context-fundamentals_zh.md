# 上下文基础技能 (Context Fundamentals Skill)

## 概览

上下文工程（Context Engineering）是管理大语言模型（LLM）接收什么信息以及如何处理这些信息的系统性方法。有效的上下文管理直接影响输出质量、一致性和任务成功率。

## 核心原则

### 1. 上下文窗口管理

上下文窗口是有限的。每一个 Token 都很重要。根据相关性和时效性对信息进行优先级排序。

**策略：**
- 总结历史对话轮次。
- 使用检索机制仅注入相关的上下文。
- 对长文档实施上下文压缩。

### 2. 信息层级

结构化上下文以引导模型的注意力：

```
1. 系统指令 (最高优先级)
   └── 角色定义
   └── 任务约束
   └── 输出格式要求

2. 相关上下文 (动态)
   └── 检索到的文档
   └── 用户特定数据
   └── 最近的对话历史

3. 用户输入 (当前请求)
   └── 查询或指令
   └── 任何内联上下文
```

### 3. 上下文相关性

并非所有上下文都同样有用。应用相关性过滤：

- **时间相关性**：最近的信息通常比旧数据权重更高。
- **语义相关性**：使用嵌入（Embeddings）来呈现相关内容。
- **任务相关性**：仅包含当前任务所需的信息。

## 上下文类型

### 静态上下文 (Static Context)
- 系统提示词
- 角色定义
- 工具描述
- 格式规范

### 动态上下文 (Dynamic Context)
- 检索到的文档 (RAG)
- 对话历史
- 用户偏好
- 会话状态

### 临时上下文 (Ephemeral Context)
- 当前工具输出
- 中间推理步骤
- 草稿本（Scratchpad）内容

## 最佳实践

1. **显式胜过隐式**：清晰地陈述要求，而不是依赖模型的推断。
2. **结构化格式**：使用一致的分隔符和章节。
3. **冗余消除**：避免在上下文的不同部分重复相同的信息。
4. **来源属性**：标明上下文来源以便于追溯。
5. **新鲜度信号**：指明信息的最后更新时间。

## 上下文模式

### RAG 集成模式
```
[系统指令]
你是一个得力的助手。使用提供的上下文来回答问题。
仅使用上下文中的信息。如果不确定，请直说。

[检索到的上下文]
<document source="doc1.pdf" date="2024-01-15">
  此处为内容...
</document>

[用户查询]
{user_input}
```

### 多轮对话上下文模式
```
[系统指令]
...

[对话历史]
前序轮次总结：{summary}

最近的交流：
用户：{recent_user_1}
助手：{recent_assistant_1}
用户：{recent_user_2}
助手：{recent_assistant_2}

[当前轮次]
用户：{current_input}
```

## 指标

- **上下文利用率**：提供的上下文中被用于响应的比例。
- **上下文相关性分数**：上下文与响应之间的语义相似度。
- **上下文压缩比**：原始大小与压缩后大小的比率。
- **信息保留度**：总结后保留的关键事实。
